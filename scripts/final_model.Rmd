---
title: "final_model"
author: "Tam Ta"
date: "5/3/2022"
output: html_document
---
#### To do list
-wait for data
-work on brochures and presentations
-figure out how to make the graphs
-run the models


#### Setup
```{r load library, include=FALSE}
library(here)
library(tidyverse)
library(dplyr)
library(raster) #for scaling
library(AICcmodavg) #for AIC
library(ggplot2)
library(readxl)
```

```{r load data, include=FALSE}
kill<-read_excel(here("data/killdata.xlsx"))%>%
  distinct(kill_num,.keep_all = TRUE)%>%
  mutate(kill=1,
         canopy_cover=`Canopy cover`)%>%
  dplyr::select(kill,species,year,jday,long,lat,elevation,slope,
                canopy_cover)
random<-read_excel(here("data/randomdata.xlsx"))%>%
  mutate(kill=0,
         slope=Slope,
         canopy_cover=`Canopy cover`)%>%
  dplyr::select(kill,long,lat,elevation,slope,canopy_cover)
```

#### Prepare datasets for model

```{r join kills and random points}
premod<-bind_rows(random,kill)
```

Scale any numerical columns, except lat/long and use/nonuse. This would involve elevation, slope, and canopy cover. Scaling would help standardize the numerical covariates --> allows us to compare coefficients to each other.

```{r scale}
premod.scale <- scale(premod[4:6])

#add back any columns that we did not scale
mod <- data.frame("kill" = premod$kill, "species" = premod$species,
                  premod.scale)
```

```{r filter data, include=FALSE}
elk.mod<-mod%>%
  filter(species=="elk" | kill == 0)
mule.mod<-mod%>%
  filter(species=="mule deer" | kill == 0)
```

#### Models & AIC

Null model to compare to logistic regressions. If AIC of logistics are above or <2 below null model, then the relationships are not significant. 
```{r null model}
null <- glm(kill ~ 1, family = binomial, data=mod)
summary(null)
```

```{r elk model}
elk<-glm(kill~elevation+canopy_cover+slope, data=elk.mod,
          family=binomial)
summary(elk)
```

```{r mule deer model}
mule<-glm(kill~elevation+canopy_cover+slope, data=mule.mod,
          family=binomial)
summary(mule)
```

Lower AIC = better. Choose model with the lowest AIC. Make sure it is >2 below the null.

```{r aic table}
#the models you're comparing
model.set <- list(m.null, m.elk, m.mule)
model.names <- c("null", "elk", "mule deer")

#makes the table
aic = aictab(model.set, modnames = model.names)
aic
```

#### Graphs

```{r prediction plots}
#prediction for mule deer
mule.plot <- data.frame(elevation=seq(min(m.mule$elevation), 
                                  max(m.mule$elevation),len=500))
mule.plot$prop = predict(m.mule, mule.plot, type="response")

#prediction for elk
elk.plot <- data.frame(elevation=seq(min(m.elk$elevation), 
                                  max(m.elk$elevation),len=500))
elk.plot$prop = predict(m.elk, elk.plot, type="response")

#bind data tables
mule.plot$species<-"Elk"
elk.plot$species<-"Mule deer"
bind.plot<-rbind(mule.plot,elk.plot)

#plot
ggplot(bind.plot, aes(x=elevation, y=prop, col=species)) +
  geom_smooth(size=1.5)+
  xlab("Elevation (m)")+
  ylab("Predicted probability of kill")+
  scale_color_manual(values = c("#39638b","#26a185"), 
                     name = "Species",
                     labels=c("Mule deer", "Elk"))
```